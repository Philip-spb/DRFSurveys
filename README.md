# API для системы опросов пользователей

### Инструкция по разворачиванию приложения в контейнере docker

1. Создаем образ `docker build -t drfsurveys .`
2. Запускаяем контейнер `docker run --rm -p 8000:8000 drfsurveys python manage.py runserver 0.0.0.0:8000`
3. Узнаем ID запущенного контейнера и выполняем следующие команды:
```sh
docker exec -it 0a5188792093 python manage.py makemigrations api
docker exec -it 0a5188792093 python manage.py migrate
docker exec -it 0a5188792093 python manage.py createsupeuser
```

В текущем состоянии наше приложение работает с БД SQLite, но можно подключить любую другую БД поддерживаемую Django при необходимости

## Документация по API 

### Функционал для администратора системы:

**Авторизация в нашей системе производится при помощи токенов.** 

Для получения токена необходимо отправить POST запрос с данными вашего пользователя системы по адресу http://127.0.0.1:8000/api/login/

```
{
    "username": "admin",
    "password": "ваш_пароль"
}
```

Если вы указали верные данные то вы получите следующие данные:

```
{
    "token": "ваш_секретный_токен"
}
```

В дальнейшем этот токен необходимо отправлять в заголовках серверу при каждом запросе к доступному только администраторам функционалу

```
Authorization: Token ваш_секретный_токен
``` 

**Добавление/изменение/удаление опросов**

Все CRUD действия с опросами выполняются при помощи запроса на адрес http://127.0.0.1:8000/api/surveys/

GET запрос выдаст все созданные опросы

POST запрос 

```
{
    "name": "Тестовый опрос 4",
    "description": "Описание тестового опроса",
    "start": "2021-12-12",
    "end": "2021-01-01"
}
```

позволит создать опрос

GET запрос по адресу http://127.0.0.1:8000/api/surveys/1/ выдаст первый опрос

DELETE запрос по адресу http://127.0.0.1:8000/api/surveys/1/ приведет к удалению первого опроса (при отсутствии неразрешенных зависимостей)

PUT запрос
``` 
{
    "name": "Тестовый опрос 4",
    "description": "Описание тестового опроса",
    "end": "2021-01-01"
}
```
по адресу http://127.0.0.1:8000/api/surveys/1/ приведет к изменению объекта. Дата старта опроса не изменяется (в соответствии с поставленными условиями)


**Добавление/изменение/удаление вопросов в опросе**

Все CRUD действия с вопросами в опросе выполняются при помощи запроса на адрес http://127.0.0.1:8000/api/questions/

GET запрос этого адреса выдаст список всех доступных в системе вопросов (без привязки к конкретному опросу)

POST запрос
```
{
    "text": "Какой ваш любимый город?",
    "type": 2,
    "survey": 1
}
```
позволит нам создать новый вопрос. В поле ```type``` мы указываем тип вопроса, в поле ```survey``` указываем на опрос к которому данный вопрос принадлежит.

Редактировать уже созданные вопросы можно по ссылке: http://127.0.0.1:8000/api/questions/1/ при помощи PUT запроса (указав необходимый номер вопроса)
Удаление вопроса производится по той же ссылке при помощи DELETE запроса


**Добавление/изменение/удаление вариантов ответов к вопросам**

Все происходит аналогичным образом по ссылке http://127.0.0.1:8000/api/choices/


### Функционал для пользователей системы:

**Получение списка активных опросов**

Список активных опросов можно получить путем отправки GET запроса по адресу http://127.0.0.1:8000/api/active-surveys/
Опрос считается активным в случае если дата начала его проведения меньше или равна текущей дате и одновременно дата окончания его проведения больше или равна текущей дате.

**Прохождение опроса**

Процесс прохождения опроса разбит на несколько этапов.

1 этап: Создается новый объект процесса прохождения опроса. Делается это путем отправки следующего POST запроса по адресу http://127.0.0.1:8000/api/test-base/
```
    {
        "test_base":{
        "user":123,
        "survey_id":1
        }
    }
```
Параметр ```user``` – это ID пользователя проходящего опрос (может быть пустым). В параметре ```survey_id``` мы указываем ID активного опроса, который мы будем проходить.

В случае успеха вы получите следующий ответ:

```
{
    "test_base": 31
}
```

```survey_id``` указывает на ID созданного объекта процесса прохождения опроса. 

Данный объект доступен по адресу http://127.0.0.1:8000/api/test-base/31/ и представляет из себя набор объектов вопросов имеющих уникальный ID. 

Пример:
```
{
    "test_base": [
        {
            "answers": [
                {
                    "id": 13,
                    "question": "Какой ваш любимый цвет?",
                    "question_type": "Ответ с выбором нескольких вариантов",
                    "choices": "Красный, Желтый, Зеленый, Синий, Ораньжевый",
                    "answer": null
                },
                {
                    "id": 14,
                    "question": "Какое ваше любимое блюдо?",
                    "question_type": "Ответ текстом",
                    "choices": "",
                    "answer": null
                },
                {
                    "id": 15,
                    "question": "Какое ваше любимое время года?",
                    "question_type": "Ответ с выбором одного варианта",
                    "choices": "Зима, Лето, Весна, Осень",
                    "answer": null
                },
                {
                    "id": 16,
                    "question": "Какой ваш любимый герой?",
                    "question_type": "Ответ текстом",
                    "choices": "",
                    "answer": null
                },
                {
                    "id": 17,
                    "question": "Какой ваш любимый цвет?",
                    "question_type": "Ответ с выбором нескольких вариантов",
                    "choices": "",
                    "answer": null
                },
                {
                    "id": 18,
                    "question": "Какой ваш любимый город?",
                    "question_type": "Ответ с выбором нескольких вариантов",
                    "choices": "",
                    "answer": null
                }
            ]
        }
    ]
}
```

2 этап: Для прохождения теста необходимо последовательно отправлять PUT запросы по адресу http://127.0.0.1:8000/api/answers/17/ (ID вопроса меняется на необходимый). 

Пример:

```
    {
        "answer": "синий"
    }
``` 

**Получение пройденных пользователем тестов с детализацией по ответам**

Для получения всех созданных пользователем тестов со всеми ответами необходимо отправить GET запрос на адрес http://127.0.0.1:8000/api/single-user-test-base/777/
(ID пользователя меняется на необходимый) 
